# 사용자가 "아이유" 입력하면 500장 출력하는 프로그램 설계
from selenium import  webdriver as wb               # 인터넷창 제어, url 이동
from selenium.webdriver.common.by import By         # 선택자
from selenium.webdriver.common.keys import Keys     # 키보드로 전송
import os         # 폴더 만들기
import requests   # 이미지 url 통해 byte 받아 올 때
import time       # 페이지 이동 시 코드 지연

# PyQt5 사용해서


def img_download():
    driver = wb.Chrome()
    url_image = "https://search.naver.com/search.naver?where=image"
    driver.maximize_window() # 간혹가다 창 크기에 따라 태그가 변하는 경우가 있음
    driver.get(url_image)
    time.sleep(0.2)
    
    # 사용자에게 입력하라는 문구
    keyword = input("검색어를 입력하세요 : ")
    import os
    # 아이유 라는 폴더를 만들자
    if not os.path.exists(keyword):
        os.mkdir(keyword)
    
    search = driver.find_element(By.CSS_SELECTOR, "#nx_query")
    search.send_keys(keyword)
    search.send_keys(Keys.ENTER)
    time.sleep(0.2)
    
    # 현재 화면에서 스크롤을 한 20번 내려볼까?
    for _ in range(20):
        body = driver.find_element(By.CSS_SELECTOR, "body")
        body.send_keys(Keys.END)
        time.sleep(0.2)
    
    img_list = driver.find_elements(By.CSS_SELECTOR, "img")
    for i, img in enumerate(img_list):
        url = img.get_attribute("src")
        # get 방식은 http, https 요청할 수 있어서
        # data:로 출발하는 url은 버리자
        if url[ : 4] == "data":
            continue
    
        import requests
        result = requests.get(url).content
        with open(f"{keyword}/{keyword}{i}.jpg", "wb") as file:
            file.write(result)
            print(f"{keyword}{i}.jpg 저장완료")
            time.sleep(0.1)
    driver.close() # 크롬 창 닫기

if __name__ == "__main__":
    img_download()
